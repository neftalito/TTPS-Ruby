<div class="bg-gray-50 min-h-screen py-12">
  <div class="max-w-4xl mx-auto p-12 bg-slate-900 rounded-3xl shadow-2xl border border-slate-700 font-sans text-gray-100">
    
    <header class="mb-10 border-b border-slate-700 pb-5 text-center">
      <h1 class="text-4xl font-extrabold text-emerald-400 tracking-widest uppercase">
        REGISTRAR NUEVA VENTA ðŸ’¸
      </h1>
      <p class="text-lg text-slate-400 mt-2 font-light">
        Ingresa los datos del cliente y agrega los productos a la transacciÃ³n.
      </p>

      <%# Manejo de Errores con estilo oscuro %>
      <% if @sale.errors.any? %>
        <div class="mt-4 p-4 rounded-lg bg-red-800/50 border border-red-700 text-red-300 text-left">
          <h4 class="font-bold mb-2">No se pudo guardar la venta:</h4>
          <ul class="list-disc list-inside text-sm">
            <% @sale.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </header>

    <%= form_with model: [:backstore, @sale], 
                  data: { controller: "nested-form", action: "submit->nested-form#submit" }, 
                  class: "space-y-12" do |form| %>

      <%# SECCIÃ“N 1: DATOS DEL CLIENTE %>
      <div class="p-8 border border-slate-700 rounded-xl bg-slate-800 shadow-xl">
        <h2 class="text-2xl font-semibold text-blue-400 mb-6 border-b border-slate-700 pb-3">Datos del Cliente</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <%= form.label :buyer_name, "Nombre Completo", class: "block text-sm font-medium text-blue-400 mb-1" %>
            <%= form.text_field :buyer_name, class: "block w-full border border-slate-700 rounded-lg px-4 py-3 bg-slate-950 text-gray-100 placeholder-slate-600 focus:ring-emerald-500 focus:border-emerald-500 transition duration-200" %>
          </div>
          
          <div>
            <%= form.label :buyer_dni, "DNI", class: "block text-sm font-medium text-blue-400 mb-1" %>
            <%= form.text_field :buyer_dni, class: "block w-full border border-slate-700 rounded-lg px-4 py-3 bg-slate-950 text-gray-100 placeholder-slate-600 focus:ring-emerald-500 focus:border-emerald-500 transition duration-200" %>
          </div>

          <div>
            <%= form.label :buyer_email, "Email", class: "block text-sm font-medium text-blue-400 mb-1" %>
            <%= form.email_field :buyer_email, class: "block w-full border border-slate-700 rounded-lg px-4 py-3 bg-slate-950 text-gray-100 placeholder-slate-600 focus:ring-emerald-500 focus:border-emerald-500 transition duration-200" %>
          </div>
        </div>
      </div>

      <%# SECCIÃ“N 2: PRODUCTOS %>
      <div class="p-8 border border-slate-700 rounded-xl bg-slate-800 shadow-xl">
        <div class="flex justify-between items-center mb-6 border-b border-slate-700 pb-3">
          <h2 class="text-2xl font-semibold text-emerald-400">Productos</h2>
        </div>

        <div data-nested-form-target="target" class="space-y-4">
          <%# AquÃ­ se renderizan los items existentes %>
          <%= form.fields_for :sale_items do |sale_item_form| %>
            <%= render "sale_item_fields", f: sale_item_form %>
          <% end %>
        </div>

        <div class="mt-6">
          <button type="button" 
                  data-action="nested-form#add"
                  class="inline-flex items-center px-6 py-3 border border-dashed border-emerald-500/50 text-sm font-medium rounded-lg text-emerald-400 bg-emerald-900/10 hover:bg-emerald-900/20 hover:border-emerald-400 transition duration-200 w-full justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            Agregar otro producto
          </button>
        </div>
        
        <template data-nested-form-target="template">
          <%= form.fields_for :sale_items, SaleItem.new, child_index: 'NEW_RECORD' do |sale_item_form| %>
            <%= render "sale_item_fields", f: sale_item_form %>
          <% end %>
        </template>
      </div>

      <%# FOOTER: BOTONES DE ACCIÃ“N %>
      <div class="pt-8 border-t border-slate-700 flex justify-end gap-4">
        <%= link_to "Cancelar", backstore_sales_path, class: "px-8 py-3 border border-slate-700 rounded-lg text-gray-300 bg-slate-800 hover:bg-slate-700 transition duration-200 font-medium tracking-wide" %>
        
        <%= form.submit "Finalizar Venta", class: "px-8 py-3 bg-emerald-400 text-slate-950 rounded-lg font-bold hover:bg-emerald-300 transition duration-200 cursor-pointer shadow-lg tracking-wider" %>
      </div>
    
    <% end %>
  </div>
</div>