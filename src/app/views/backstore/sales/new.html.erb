<div class="min-h-screen py-12 bg-proyecto-bg">
  <div class="max-w-4xl mx-auto p-8 md:p-12 bg-proyecto-secondary/10 rounded-3xl shadow-2xl border border-proyecto-text/10 font-sans">
    
    <header class="mb-10 border-b border-proyecto-text/10 pb-5 text-center">
      <h1 class="text-4xl font-extrabold text-proyecto-primary tracking-widest uppercase">
        Registrar Nueva Venta 
      </h1>
      <p class="text-lg text-proyecto-text/60 mt-2 font-light">
        Ingresa los datos del cliente y agrega los productos a la transacci√≥n.
      </p>

      <% if @sale.errors.any? %>
        <div class="mt-6 p-4 rounded-lg bg-proyecto-error/10 border border-proyecto-error/20 text-proyecto-error text-left animate-pulse">
          <h4 class="font-bold mb-2 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            No se pudo guardar la venta:
          </h4>
          <ul class="list-disc list-inside text-sm ml-5">
            <% @sale.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </header>

    <%= form_with model: [:backstore, @sale], 
                  data: { controller: "nested-form", action: "submit->nested-form#submit" }, 
                  class: "space-y-12" do |form| %>

      <div class="p-8 border border-proyecto-text/10 rounded-xl bg-proyecto-bg/50 shadow-sm">
        <h2 class="text-2xl font-semibold text-proyecto-primary mb-6 border-b border-proyecto-text/10 pb-3 flex items-center gap-2">
          Datos del Cliente
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <%= form.label :buyer_name, "Nombre Completo *", class: "block text-sm font-medium text-proyecto-text/80 mb-1" %>
            <%= form.text_field :buyer_name, required: true, class: "block w-full border border-proyecto-text/20 rounded-lg px-4 py-3 bg-proyecto-bg text-proyecto-primary placeholder-proyecto-text/40 focus:border-proyecto-accent focus:ring-proyecto-accent transition duration-200" %>
          </div>
          
          <div>
            <%= form.label :buyer_dni, "DNI *", class: "block text-sm font-medium text-proyecto-text/80 mb-1" %>
            <%= form.text_field :buyer_dni, required: true, class: "block w-full border border-proyecto-text/20 rounded-lg px-4 py-3 bg-proyecto-bg text-proyecto-primary placeholder-proyecto-text/40 focus:border-proyecto-accent focus:ring-proyecto-accent transition duration-200" %>
          </div>

          <div>
            <%= form.label :buyer_email, "Email *", class: "block text-sm font-medium text-proyecto-text/80 mb-1" %>
            <%= form.email_field :buyer_email, required: true, class: "block w-full border border-proyecto-text/20 rounded-lg px-4 py-3 bg-proyecto-bg text-proyecto-primary placeholder-proyecto-text/40 focus:border-proyecto-accent focus:ring-proyecto-accent transition duration-200" %>
          </div>
        </div>
      </div>

      <div class="p-8 border border-proyecto-text/10 rounded-xl bg-proyecto-bg/50 shadow-sm">
        <div class="flex justify-between items-center mb-6 border-b border-proyecto-text/10 pb-3">
          <h2 class="text-2xl font-semibold text-proyecto-primary flex items-center gap-2">
            Productos
          </h2>
        </div>

        <div data-nested-form-target="target" class="space-y-4" data-controller="unique-selection">
          <%= form.fields_for :sale_items do |sale_item_form| %>
            <%= render "sale_item_fields", f: sale_item_form %>
          <% end %>
        </div>

        <div class="mt-8">
          <button type="button" 
                  data-action="nested-form#add"
                  class="inline-flex items-center px-6 py-3 border border-dashed border-proyecto-accent/40 text-sm font-medium rounded-lg text-proyecto-accent bg-proyecto-accent/5 hover:bg-proyecto-accent/10 hover:border-proyecto-accent transition duration-200 w-full justify-center group">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 group-hover:scale-110 transition-transform" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            Agregar otro producto
          </button>
        </div>
        
        <template data-nested-form-target="template">
          <%= form.fields_for :sale_items, SaleItem.new, child_index: 'NEW_RECORD' do |sale_item_form| %>
            <%= render "sale_item_fields", f: sale_item_form %>
          <% end %>
        </template>
      </div>

      <div class="pt-8 border-t border-proyecto-text/10 flex flex-col sm:flex-row justify-end gap-4">
        <%= link_to "Cancelar", backstore_sales_path, class: "px-8 py-3 border border-proyecto-text/20 rounded-lg text-proyecto-text hover:bg-proyecto-secondary/20 transition duration-200 font-medium text-center" %>
        
        <%= form.submit "Finalizar Venta", class: "px-8 py-3 bg-proyecto-primary text-proyecto-bg rounded-lg font-bold hover:bg-proyecto-accent transition duration-200 cursor-pointer shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 text-center" %>
      </div>
    
    <% end %>
  </div>
</div>