<%= form_with(model: [:backstore, @user], local: true, class: "space-y-5") do |f| %>

  <% if @user.errors.any? %>
    <div class="bg-proyecto-secondary border border-proyecto-accent text-proyecto-accent px-4 py-3 rounded">
      <ul class="list-disc list-inside">
        <% @user.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- EMAIL -->
  <div>
    <label class="block font-semibold mb-1 text-proyecto-text">
      <i class="fa-solid fa-envelope mr-1"></i>
      Email
    </label>
    <%= f.email_field :email,
                      class: "w-full px-3 py-2 border border-proyecto-secondary rounded-lg focus:ring-proyecto-primary focus:border-proyecto-primary text-proyecto-text bg-proyecto-bg" %>
  </div>

  <!-- PASSWORD -->
  <div>
    <label class="block font-semibold mb-1 text-proyecto-text">
      <i class="fa-solid fa-lock mr-1"></i>
      Contraseña
    </label>
    <%= f.password_field :password,
                         class: "w-full px-3 py-2 border border-proyecto-secondary rounded-lg focus:ring-proyecto-primary focus:border-proyecto-primary text-proyecto-text bg-proyecto-bg" %>
  </div>

  <!-- PASSWORD CONFIRMATION -->
  <div>
    <label class="block font-semibold mb-1 text-proyecto-text">
      <i class="fa-solid fa-lock mr-1"></i>
      Confirmar Contraseña
    </label>
    <%= f.password_field :password_confirmation,
                         class: "w-full px-3 py-2 border border-proyecto-secondary rounded-lg focus:ring-proyecto-primary focus:border-proyecto-primary text-proyecto-text bg-proyecto-bg" %>
  </div>

  <!-- ROLE (solo admins y gerentes) -->
  <% if can? :manage, User %>
    <div>
      <label class="block font-semibold mb-1 text-proyecto-text">
        <i class="fa-solid fa-user-tag mr-1"></i>
        Rol
      </label>

      <%= f.select :role,
                   User.roles.keys.map { |r| [translated_role(r), r] },
                   {},
                   class: "w-full px-3 py-2 border border-proyecto-secondary rounded-lg focus:ring-proyecto-primary focus:border-proyecto-primary text-proyecto-text bg-proyecto-bg" %>
    </div>
  <% end %>

  <!-- BUTTONS -->
  <div class="flex justify-end space-x-3 pt-4">
    <%= link_to "Cancelar",
                backstore_users_path,
                class: "px-4 py-2 rounded-lg bg-proyecto-secondary text-proyecto-primary hover:bg-proyecto-accent hover:text-proyecto-bg" %>

    <%= f.submit @user.new_record? ? "Crear Usuario" : "Guardar Cambios",
                 class: "px-5 py-2 rounded-lg bg-proyecto-primary text-proyecto-bg hover:bg-proyecto-accent" %>
  </div>

<% end %>