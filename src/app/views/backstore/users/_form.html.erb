<%= form_with(model: [:backstore, @user], local: true, class: "space-y-10") do |f| %>
  <% if @user.errors.any? %>
    <div class="p-4 rounded-lg bg-proyecto-error/10 border border-proyecto-error/20 text-proyecto-error animate-pulse">
      <h4 class="font-bold mb-2 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        No se pudo guardar el usuario:
      </h4>
      <ul class="list-disc list-inside text-sm ml-5">
        <% @user.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="p-8 border border-proyecto-text/10 rounded-xl bg-proyecto-bg/50 shadow-sm space-y-6">
    <div class="space-y-2">
      <p class="text-sm uppercase tracking-widest text-proyecto-primary font-semibold">Credenciales de acceso</p>
      <p class="text-sm text-proyecto-text/70">Ingresa la información de inicio de sesión del colaborador.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="space-y-1">
        <%= f.label :email, "Email", class: "block text-sm font-medium text-proyecto-text/80" %>
        <%= f.email_field :email,
                          class: "w-full px-4 py-3 rounded-lg border border-proyecto-text/20 bg-white text-proyecto-primary placeholder-proyecto-text/40 focus:border-proyecto-accent focus:ring-proyecto-accent transition duration-200" %>
      </div>

      <div class="space-y-1">
        <%= f.label :password, "Contraseña", class: "block text-sm font-medium text-proyecto-text/80" %>
        <%= f.password_field :password,
                             class: "w-full px-4 py-3 rounded-lg border border-proyecto-text/20 bg-white text-proyecto-primary placeholder-proyecto-text/40 focus:border-proyecto-accent focus:ring-proyecto-accent transition duration-200" %>
        <% if @user.persisted? %>
          <p class="text-xs text-proyecto-text/60">Déjalo vacío para mantener la contraseña actual.</p>
        <% end %>
      </div>

      <div class="space-y-1">
        <%= f.label :password_confirmation, "Confirmar Contraseña", class: "block text-sm font-medium text-proyecto-text/80" %>
        <%= f.password_field :password_confirmation,
                             class: "w-full px-4 py-3 rounded-lg border border-proyecto-text/20 bg-white text-proyecto-primary placeholder-proyecto-text/40 focus:border-proyecto-accent focus:ring-proyecto-accent transition duration-200" %>
      </div>

      <% if can? :manage, User %>
        <div class="space-y-1">
          <%= f.label :role, "Rol", class: "block text-sm font-medium text-proyecto-text/80" %>
          <%= f.select :role,
                       User.roles.keys.map { |r| [translated_role(r), r] },
                       {},
                       class: "w-full px-4 py-3 rounded-lg border border-proyecto-text/20 bg-white text-proyecto-primary focus:border-proyecto-accent focus:ring-proyecto-accent transition duration-200" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="pt-6 border-t border-proyecto-text/10 flex flex-col sm:flex-row justify-end gap-4">
    <% submit_label = @user.new_record? ? "Crear Usuario" : "Guardar Cambios" %>
    <% submit_icon = @user.new_record? ? "fa-user-plus" : "fa-floppy-disk" %>

    <%= link_to backstore_users_path,
                class: "inline-flex items-center justify-center gap-2 px-8 py-3 border border-proyecto-text/20 rounded-lg text-proyecto-text hover:bg-proyecto-secondary/20 transition duration-200 font-medium text-center" do %>
      <i class="fa-solid fa-arrow-left"></i>
      <span>Cancelar</span>
    <% end %>

    <%= f.button type: :submit,
                 class: "inline-flex items-center justify-center gap-2 px-8 py-3 bg-proyecto-primary text-proyecto-bg rounded-lg font-bold hover:bg-proyecto-accent transition duration-200 cursor-pointer shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 text-center" do %>
      <i class="fa-solid <%= submit_icon %>"></i>
      <span><%= submit_label %></span>
    <% end %>
  </div>
<% end %>
