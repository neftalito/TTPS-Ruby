<!DOCTYPE html>
<html>
<head>
  <title>Administración</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= yield :head %>

  <link rel="icon" href="/icon.png" type="image/png">
  <link rel="apple-touch-icon" href="/icon.png">

  <%= vite_client_tag %>
  <%= vite_javascript_tag 'application' %>
</head>

<body class="bg-proyecto-bg text-proyecto-text min-h-screen flex">

<!-- DESKTOP SIDEBAR -->
<aside class="hidden md:flex">
  <%= render "backstore/shared/sidebar" %>
</aside>

<!-- MOBILE MENU BUTTON -->
<button
  class="md:hidden fixed top-4 left-4 z-50 bg-proyecto-primary text-proyecto-bg p-2 rounded shadow"
  onclick="document.getElementById('mobileSidebar').classList.remove('hidden')">
  <i class="fa-solid fa-bars"></i>
</button>

<!-- MOBILE SIDEBAR OVERLAY -->
<div id="mobileSidebar"
     class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"
     onclick="this.classList.add('hidden')">

  <aside class="w-64 bg-proyecto-primary text-proyecto-bg min-h-full py-6 px-4"
         onclick="event.stopPropagation()">

    <%= render "backstore/shared/sidebar" %>

  </aside>
</div>

<!-- MAIN CONTENT -->
<div class="flex-1 flex flex-col">

  <!-- TOP NAVBAR -->
  <header class="w-full bg-proyecto-secondary shadow px-6 py-4 flex justify-between items-center">
    <h1 class="text-xl font-semibold text-proyecto-primary">Panel Administrativo</h1>

    <div class="flex items-center gap-4">

      <% if user_signed_in? %>
            <span class="flex items-center gap-2 text-proyecto-text">
              <i class="fa-solid fa-user"></i>
              <%= current_user.email %>
            </span>

        <%= link_to edit_backstore_user_path(current_user),
                    class: "px-3 py-1 rounded bg-proyecto-secondary text-proyecto-primary hover:bg-proyecto-accent hover:text-proyecto-bg flex items-center gap-2" do %>
          <i class="fa-solid fa-id-badge"></i>
          <span>Perfil</span>
        <% end %>

        <%= button_to destroy_user_session_path,
                      method: :delete,
                      class: "px-3 py-1 bg-proyecto-accent text-proyecto-bg rounded hover:bg-proyecto-primary hover:text-proyecto-bg flex items-center gap-2" do %>
          <i class="fa-solid fa-right-from-bracket"></i>
          Salir
        <% end %>

      <% else %>
        <%= link_to new_user_session_path,
                    class: "px-3 py-1 bg-proyecto-primary text-proyecto-bg rounded hover:bg-proyecto-accent flex items-center gap-2" do %>
          <i class="fa-solid fa-right-to-bracket"></i>
          Ingresar
        <% end %>
      <% end %>

    </div>
  </header>

  <!-- MAIN VIEW CONTENT -->
  <main class="flex-1 p-6">
    <%= yield %>
  </main>

</div>

<%= render "shared/modal" %>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("flashModal");
        const content = document.getElementById("flashModalContent");

        <% if flash[:notice] %>
        content.innerHTML = `
        <h2 class="text-xl font-bold text-proyecto-primary mb-2">
          <i class="fa-solid fa-circle-check"></i>
          Éxito
        </h2>
        <p class="text-proyecto-text"><%= flash[:notice] %></p>
      `;
        modal.classList.remove("hidden");
        <% elsif flash[:alert] || flash[:error] %>
        content.innerHTML = `
        <h2 class="text-xl font-bold text-proyecto-accent mb-2">
          <i class="fa-solid fa-circle-exclamation"></i>
          Error
        </h2>
        <p class="text-proyecto-text"><%= flash[:alert] || flash[:error] %></p>
      `;
        modal.classList.remove("hidden");
        <% end %>
    });
</script>

</body>
</html>
